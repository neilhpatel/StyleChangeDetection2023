you want the demand letter to look like you gave them a reasonable amount of time to get their affairs in order before you sued them when you go to court and show it to a judge as to why you feel you should be entitled to payment. so while technically you could give them as little as 1 day, it would look better to a judge if you gave them something like 30 days.
send him a certified letter detailing the amount of money they owe you. give him an amount of days to start payment. if they don't start payment file in small claims court where they live. you will have to travel there to sue them. bring the bill, texts documenting their agreement to pay you, and a copy of the demand letter with proof it was sent.
if you google "demand letter template for money owed" you get some free forms to download and some images of pretty standard letters you can base yours off of. just make sure you send it certified mail so that there's proof it was mailed and he received it.
Starting with the easiest part: this guy has no case against you for defamation over things you've said to them privately. Even if you said things publicly, as long as they are true, you have a defense. Don't worry about his threat, but if you do get served with an actual lawsuit, get a lawyer.
Regarding money your friend owes you, you would have to sue him, perhaps in small claims court. You don't need a lawyer for that.