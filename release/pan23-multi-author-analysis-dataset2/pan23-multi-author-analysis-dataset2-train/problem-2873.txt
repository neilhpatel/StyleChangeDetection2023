But neither of us were there and if your friend was as stressed as you say he was, maybe his memory of events is less clear than it should be.
Look from the police perspective. They arrived at a burglary scene and saw a man running around with a gun. He did not legally possess the firearm as he had illegal narcotics in his possession. If he was using cocaine at the same time period as the purchase, he lied on his firearm background check and purchased it illegally.
Barking out orders and questioning him is 100% reasonable for police to do when they show up to a burglary and see a guy with a gun running around. It is absolutely reasonable to place him in handcuffs with firearms pointed at him until he is restrained, as he was armed with a firearm. They dont know who he is and burglars tend to lie about motives, so it is reasonable they spoke to the girls. They will also verify who he is before uncuffing a guy after running around with a gun.
In terms of the retrieval of the ID, there arent enough details to make a determination. Where was it parked? Were there K9s present? Were the drugs in plain view? Did he present any indicators of intoxication? Was it an apartment or a house? Did he say the magic words “You can go get my ID?” There are a mountain of case law exceptions to a vehicle search that may be in play here. Vehicles are one of the easiest things to search without a warrant under the Carol Doctrine. If this happened before April 7, then the smell of marijuana could have been enough pc to search the vehicle without a warrant.