Hi, I'm a historian of 20th century European history, currently writing my MA-thesis on a topic related to the Spanish Civil War. I'm going to try to answer this as coherently as possible, but it's a surprisingly complex matter.
Really goes to show how ideology can shift depending on the actual conditions of the people throughout history. Leftists appropriating discriminatory rethoric against colonial people that however become enforcers of Spanish conservative nationalism.
The first thing you've pointed out correctly already in your question is that the 'Moors' feature extensively in Republican propaganda, and that its discriminatory undertone is contrary to the internationalism and progressism of its supposedly leftist foundations. Their presence therein has a longer history than the military uprising that started in 1936.
Before the start of the Civil War, Spain's presence in Morocco between the 1860s and 1920s was hard-fought and often contested by various segments of the populations of the Moroccan littoral, the Atlas mountains, and Western Sahara. Before the catastrophic loss of its Asian and American colonies in 1898, Spain had held towns on Morocco's Mediterranean coast and through treaties and limited military intervention maintained a presence in the region since the 16th century. With the loss of the colonies in 1898, Morocco became the focus of Spain's efforts to regain its imperial prestige. In several disastrous expeditions - the Second (1909) and Third (1911-12) Melilla Campaigns it had failed to make any military gains and secure the mountainous Rif and its rich mineral resources. The horrifying losses of life, equipment by the Army (mostly made up out of poor, illiterate metropolitan conscripts) to no meaningful gain spurred it to raise units in Melilla and Ceuta from the local population. These indigenuous troops were not conscripts, but professional soldiers, which their name - the Fuerzas Regulares Indigenás - attests.
In the Rif War from 1920 to 1927 the Regulares developed a reputation for ferocity, reliability, and endurance. Together with the Legión Espanola (the Spanish [Foreign] Legion) the Regulares formed the professional backbone of Spain's overseas armed forces. The fact that these troops consistently saw combat throughout the 1910s and 1920s even though Spain remained neutral in the Great War is of some importance looking ahead to the Civil War in 1936, bear this in mind.
The emergence of the Legión and the Regulares as elite forces was paired with the emergence of a group of officers that supported the expansion of the African empire and had the political network and associates to compete for this in national politics. The Africanista officers included future Nationalists including that of Franco, Millan Astray, Yagüe, an Berenguer. The ambitions of these men were not only in the realm of empire, but also permeated their hunger for promotions. General Primo de Rivera would successfully strongarm the Monarchy into granting him dictatorial powers, and the rest of the officers, including Franco, eventually secured major promotions, including postings at prestiguous military academies.
With the 1931 overthrow of the Monarchy and Primo de Rivera's dictatorship, the Africanistas became one of many factions on the right of the political spectrum, and found allies in the younger Primo de Rivera's Falange Espagnola and other radical or even fascist organisations for the realisation of their ambitions at home and abroad.
The severe economic downturn that hit Spain as part of the Great Depression combined with the incendiary political atmosphere of the early 1930s erupted in wholesale violence already in 1934. In October that year miners in the province of Asturias - the only province of Spain never to see Moorish occupation in Medieval times - revolted and took up arms against the government. Though the government was nominally one of the people, it was a government nonetheless in its decision to crack down on the strikes and the revolt. Fearing that metropolitan units made up out of conscripts would join the miners and threaten Madrid, the government decided to transport Regulares and the Legión under Franco's leadership to Asturias by ship and train to have them suppress the rebellion. There are some pretty good personal accounts of leftist conscripts joining the miners, including the story of Sargento Vazquez, which is central to my MA-thesis - but back to the narrative.
The violence with which Franco put down the 1934 revolt, and the role of Moorish soldiers of the Regulares in it shocked many across the political spectrum, most of all on the left. In particular the trade unions UGT and CNT, and the socialist party PSOE developed an intrinsic hatred of the Regulares.
The military uprising of July 1936 then once again featured the 'foreign' Regulares, again under the leadership of Franco in a central role. During the Defence of Madrid, the CNT, UGT, PSOE, and especially PCE were key players in the organising of militia units to hold off the Nationalists before loyal Republican Army formations could push them back. These political organisations - most of which still had extremely bitter memories to 1934 - organised nearly 20 battalions of militiamen, largely through the famous Fifth Regiment (not the same as the Fifth Brigade; this referred to the International Brigade red.). These militias initially had neither military nor political discipline, but fought extremely tenaciously against Nationalist columns bearing down on the city, including Regulares on the Northern frontage near the city. Throughout late 1936 and early 1937 these troops would continue defending the city, making the Battle for Madrid a centrepiece of the Civil War in general. The fact that the Moors fought the same organisations in 1936 as they did two yeas before is of great significance, and the fact that they did so most ruthlessly and bravely gave them an interesting mixed reputation. On the one hand they were enemy shock troops of commendable bravery (nearly equivalent to the IB troops) as well as an oppressed people, on the other hand they were ruthless in their treatment of prisoners and viewed as defilers of Spain's last Christian vestiges.
By the time the song - Ay Carmela/Viva la Quince Brigada/Viva la Quinta Brigada - became popular, circa autumn 1938 the Republicans had lost significant ground at the Battle of the Ebro. The consequent hardening of the war rhetoric, and the intensification of political propaganda efforts across the board normalised the harsher, discriminatory rhetoric. To little avail, anyway.
Alpert, Michael. The Republican Army in the Spanish Civil War, 1936-1939 (Cambridge: Cambridge University Press, 2013).
Colodny, Robert G., and Beth Luey (editor, 2009 edition). The Struggle for Madrid – The central epic of the Spanish conflict 1936-37 (New York, NY: Paine-Whitman, 1958/2009).
Engel, Carlos. Historia de las Brigadas Mixtas del Ejército Popular de la República. (Madrid, Almena, 1999).
Kirschenbaum, Lisa A. International Communism and the Spanish Civil War: Solidarity and Suspicion (Cambridge, UK: Cambridge University Press, 2015) pp. 168-187.