How is this excessive force? You need to discuss all of this with your attorney. No one on the Internet can guess if this was a valid search. The officer smelling marijuana may have been enough to search, and the dog might have been an additional layer.
That's super shitty officer safety, but if the officer smelled marijuana, that established probable cause to search for it.
The officer had probable cause to initiate the traffic stop and detain you (traffic violation.) The officer claims they could smell the odor marijuana eminating from the interior of the vehicle. Probable cause existed to search the vehicle and its occupants for marijuana. The K-9 seems like overkill. A subsequent K-9 search led to an alert on an area of the vehicle where marijuana was located.
You have the right to decline consensual searches. You do not have the right to say "no" when a peace officer says "I'm conducting a search." The roadside is not a courtroom, and you have no idea what probable cause the officer may, or may not have at that time.
Then at your first court appearance you should inform the judge that you cannot afford an attorney and would like to apply for a public defender.
Do you have an attorney representing you for your charges? Because these would be great questions for them.