Cervantes published the book in 1605, over a century after the Reconquista that made Spain Christian once more. However, this was four years prior to the Moriscos being expelled from Spain in 1609. (Morisco being the term applied to the descnedants of Muslims that had converted to Christianity.) Cervantes was writing in a turbulent time, and he had experienced many slices of life. He left Spain for Renaissance Italy, fought in the navy of the Catholics in the Ottoman-Hapsburg war, had been enslaved in Algiers for a few years, and also imprisoned by Spain when found abusing his role as a tax collector.
That makes sense. I teach a class on the history of the literary essay, and in the field we often point to Hamlet as an "essayistic" play, its tone is likely directly influenced by an edition of Montaigne's Essays, which were printed for the first time only a few decades before and which there's some evidence that Shakespeare read. (Hamlet explores himself at the same time that he grapples with a moral issue, he's digressive, etc..).